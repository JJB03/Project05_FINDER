<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{/layout/company_layout}">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>점수 환산 페이지</title>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>


    <style>
        .job-list {
            margin-top: 20px;
            border-radius: 8px;
        }

        .job-header {
            color: #fff;
            background-color: #005AAB;
            padding: 10px;
            margin-bottom: 35px;
            border-radius: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            height: 130px;
            font-size: 28px;
        }


        .keyword-span span {
            background-color: #f8f8f8;
            color: #5d5d5d;
            border-radius: 20px;
            padding: 5px;
            font-size: 15px;
            /* opacity: 0.9; */
            font-weight: bold;
            transition: background-color 0.5s ease;
        }

        .keyword-span-green span {
            background-color: #128246;
            color: black;
            border-radius: 20px;
            padding: 5px 16px 5px 16px;
            font-size: 15px;
            /* opacity: 0.9; */
            font-weight: bold;
        }


        .keyword-span-red span {
            background-color: red;
            color: black;
            border-radius: 20px;
            padding: 5px 10px 5px 10px;
            font-size: 15px;
            /* opacity: 0.9; */
            font-weight: bold;
        }

        .score-search {

            color: #828282;
            font-size: 13px !important;
            width: 50% !important;
            height: 32px !important;
            border-radius: 8px !important;
            border: #fff;
            transition: box-shadow 0.3s ease;
            transition: outline 0.3s ease !important;
            padding: 15px;
            margin-right: 15px;
        }
    </style>
</head>

<body layout:fragment="content">


    <div class="container-fluid container">
        <div style="display: flex; flex-direction: column; margin-left: 100px; margin-bottom: 50px;">
            <strong style="font-size: 45px; margin-bottom: 15px;">AI 평가</strong>
            <strong style="font-size: 19px;">새로운 길을 만드는 여정에 함께하세요.</strong>
        </div>

        <div class="row justify-content-center" style="padding: 0 40px 0 40px;">
            <nav class="col-12 col-sm-12 col-lg-3 sidebar">
                <div style="margin: 15px 0 45px 15px;">
                    <strong style="font-size: 24px;">
                        마이페이지
                    </strong>
                </div>
                <ul class="nav flex-column ul-header">
                    <li class="li-header">
                        <strong class="fs-5">기업 정보</strong>
                    </li>
                    <li class="nav-item">
                        <a href="/company/introduce_com" class="job-item-link nav-link fw-normal fs-6">
                            <div style="background-color: #fff; border-radius: 8px;" class="d-flex gap-2 p-2 ps-2">
                                <div>
                                    <img src="/img/home.png" alt="x">
                                </div>
                                <div>
                                    기업 소개
                                </div>
                            </div>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/user/update_user" class="job-item-link nav-link fw-normal fs-6">
                            <div style="background-color: #fff; border-radius: 8px;" class="d-flex gap-2 p-2 ps-2">
                                <div>
                                    <img src="/img/Registration.png" alt="x">
                                </div>
                                <div>
                                    담당자 정보 수정
                                </div>
                            </div>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/company/credit/credit_list_com" class="job-item-link nav-link fw-normal fs-6">
                            <div style="background-color: #fff; border-radius: 8px;" class="d-flex gap-2 p-2 ps-2">
                                <div>
                                    <img src="/img/CreditCard.png" alt="x">
                                </div>
                                <div>
                                    결제 내역
                                </div>
                            </div>
                        </a>
                    </li>
                </ul>
                <ul class="nav flex-column ul-header">
                    <li class="li-header">
                        <strong class="fs-5">채용공고 관리</strong>
                    </li>
                    <li class="nav-item">
                        <a href="/recruit/post_jobs_com" class="job-item-link nav-link fw-normal fs-6">
                            <div style="background-color: #fff; border-radius: 8px; " class="d-flex gap-2 p-2 ps-2">
                                <div>
                                    <img src="/img/list.png" alt="x">
                                </div>
                                <div>
                                    채용공고 등록
                                </div>
                            </div>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/recruit/posted_jobs_com" class="job-item-link nav-link fw-normal fs-6">
                            <div style="background-color: #fff; border-radius: 8px; " class="d-flex gap-2 p-2 ps-2">
                                <div>
                                    <img src="/img/list.png" alt="x">
                                </div>
                                <div>
                                    등록한 채용공고
                                </div>
                            </div>
                        </a>
                    </li>
                </ul>
                <ul class="nav flex-column ul-header">
                    <li class="li-header">
                        <strong class="fs-5">이력서 관리</strong>
                    </li>
                    <li class="nav-item">
                        <a href="/recruit/recruit_list_com" class="job-item-link nav-link fw-normal fs-6">
                            <div style="background-color: #fff; border-radius: 8px; " class="d-flex gap-2 p-2 ps-2">
                                <div>
                                    <img src="/img/Documents.png" alt="x">
                                </div>
                                <div>
                                    제출된 이력서
                                </div>
                            </div>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/company/score_com" class="job-item-link nav-link fw-normal fs-6">
                            <div style="background-color: #fff; border-radius: 8px; " class="d-flex gap-2 p-2 ps-2">
                                <div>
                                    <img src="/img/Documents.png" alt="x">
                                </div>
                                <div>
                                    AI 간편 평가
                                </div>
                            </div>
                        </a>
                    </li>
                </ul>
            </nav>


            <!-- 여기서 부터 시작-->
            <main class="col-12 col-md-12 col-lg-8 main-content d-flex justify-content-end align-items-start">
                <div class="job-listings ">

                    <form class="job-header mb-1">
                        <div style="padding: 16px;"><strong>점수 환산</strong>
                            <div class="d-flex justify-content-end align-items-center me-3 mb-0" style="margin: 10px;">

                            </div>
                        </div>
                    </form>



                    <div class="container mt-0 justify-content-center">
                        <div style="margin-bottom: 20px; margin-top: 13px;">
                            <span style="margin-right: 15px;"><strong>지원자<span style="color: #155ADC; margin-left: 5px;"
                                        th:text="|${resumeList.size()}명|"></span></strong></span>
                            <span style="margin-right: 15px;"><strong>합격<span
                                        style="color: #128246; margin-left: 5px;">3명</span>
                                </strong></span>
                            <span style="margin-right: 15px;"><strong>불합격<span
                                        style="color: red; margin-left: 5px;">3명</span></strong></span>
                        </div>

                        <div class="item d-flex justify-content-between">
                            <div class="keyword-span" id="outputContainer">
                            </div>
                            <div class="gap-2 d-flex">
                                <div class="d-flex justify-content-center">
                                    <div class="d-flex justify-content-center">
                                        <input type="text" name="keyword" id="keyword" placeholder="keyword" class="p-1"
                                            style="border: 1px solid var(--bs-border-color); padding: 1rem .75rem; border-radius: 8px; width: auto; min-width: 100px; max-width: 100%;">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div>
                            <div class="job-list mt-1">
                                <ol class="list-group">
                                    <li class="list-group-item"><strong style="font-size: 20px;">지원자 순위</strong></li>

                                    <input type="hidden" name="" id="input-msg" value="">

                                    <th:block th:each="resume, stat : ${resumeList}">
                                        <li class="list-group-item d-flex justify-content-between">
                                            <div class="d-flex align-items-center">
                                                <div>
                                                    <strong th:text="|${stat.index + 1}.|"></strong>
                                                    <span style="margin-right: 20px;"
                                                        th:text="${resume.user.userName}"></span>
                                                </div>

                                                <div>
                                                    <span style="color:#128246;"><strong id="content">점수</strong></span>
                                                </div>
                                            </div>
                                            <div class="keyword-span-green d-flex">
                                                <!-- <div class="d-flex ">
                                                    <span class="btn-in-short text-center">합격</span>
                                                </div> -->
                                                <div>
                                                    <button class="btn-in-short" style="font-weight: bold;">FINDER</button>
                                                </div>
                                            </div>
                                        </li>
                                    </th:block>

                                </ol>
                                <!-- 페이징 -->
                                <nav aria-label="Page navigation example"
                                    class="pagination-container justify-content-center d-flex mt-4">
                                    <ul class="pagination">
                                        <li class="page-item">
                                            <a class="page-link" href="#" aria-label="Previous">
                                                <span aria-hidden="true">&laquo;</span>
                                            </a>
                                        </li>
                                        <li class="page-item"><a class="page-link" href="#">1</a></li>
                                        <li class="page-item"><a class="page-link" href="#">2</a></li>
                                        <li class="page-item"><a class="page-link" href="#">3</a></li>
                                        <li class="page-item"><a class="page-link" href="#">4</a></li>
                                        <li class="page-item"><a class="page-link" href="#">5</a></li>
                                        <li class="page-item">
                                            <a class="page-link" href="#" aria-label="Next">
                                                <span aria-hidden="true">&raquo;</span>
                                            </a>
                                        </li>

                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
            </main>


        </div>
    </div>

    <script>
        $(document).ready(function () {
            // 키워드 입력 처리
            $('#keyword').off('keypress').on('keypress', function (event) {
                if (event.key === 'Enter') {
                    event.preventDefault(); // Prevent the default form submission
                    var inputValue = $(this).val();
                    if (inputValue.trim() !== '') { // Check if the input is not empty
                        var newSpanElement = $('<input>', {
                            type: 'text',
                            class: 'form-control input-keyword',
                            readonly: true,
                            style: 'font-size: 11px;',
                            id: 'keywordForm',
                            name: 'keyword',
                            value: '#' + inputValue
                        });
                        $('#outputContainer').append(newSpanElement); // Append the new span to the container
                    }
                    $(this).val(''); // Clear the input field
                }
            });

            let btn = document.getElementById('btn')
            let API_KEY = 'sk-proj-s5VniPhWWw53bXWO158KT3BlbkFJrbnzXIE7ktytquBwsTIO'

            if (API_KEY == '') {
                alert('API_KEY 를 변수에 입력하세요.')
            }

            btn.addEventListener('click', function () {

                let request = new XMLHttpRequest()
                let result = document.getElementById('result')
                let content = document.getElementById('content')

                let msg = document.getElementById('input-msg').value

                let data = {
                    "model": "gpt-3.5-turbo",
                    "messages": [
                        {
                            "role": "user",
                            "content": msg
                        }
                    ],
                    "temperature": 1,
                    "max_tokens": 256,
                    "top_p": 1,
                    "frequency_penalty": 0,
                    "presence_penalty": 0
                }

                // 응답 확인
                request.onreadystatechange = function () {
                    // 요청 성공
                    if (request.readyState == request.DONE && request.status == 200) {
                        let response = request.responseText
                        // alert(response)
                        // JSON.parse() : text --> JSON 변환
                        // result = JSON.parse(response)

                        // 전체 응답 메시지 (JSON)
                        result.textContent = response

                        // JSON 문자열 -> 객체
                        let object = JSON.parse(response)
                        let contentValue = object.choices[0].message.content

                        // 응답 메시지 중, 채팅 답변만
                        content.textContent = contentValue


                    }

                    // 에러 발생
                    if (request.readyState == request.DONE && request.status == 500) {
                        alert('서버측 에러 발생')
                    }
                }

                // 요청 설정
                let url = 'https://api.openai.com/v1/chat/completions'

                request.open("POST", url, true)
                request.setRequestHeader("Content-Type", "application/json")
                request.setRequestHeader("Authorization", "Bearer " + API_KEY)

                // JSON.stringify() : JavaScript 의 객체를 JSON 문자열로 변환하는 메소드
                request.send(JSON.stringify(data))

            })

        });


    </script>
</body>

</html>